var share=share||{};baidu.dom.ready(function(){var l=baidu.g("appShareTag"),c=baidu.array.each,i=baidu.event.on,r;if(!l){return}var h=132,n=104,b="http://act.hi.baidu.com/activity/data/user/";var s=baidu.g;var d=baidu.ajax.request;var q=s("publish");var f="/share/cm/";var j={Linear:function(v,g,x,w){return x*v/w+g}};var a=[];var o=function(g){if(g.tagId){var v="_method=create_share&shid="+g.shId+"&tag_id="+g.tagId+"&bdstoken="+s("bdstoken").value}else{var v="_method=create_share&shid="+g.shId+"&tag_text="+g.tagText+"&bdstoken="+s("bdstoken").value}d(f,{method:"post",data:v,onsuccess:function(y,x){var w=baidu.json.parse(y.responseText);if(r){last=r}if(w.error.errno==0){Space.Libs.ns_trackerLink("m_20100402_detailTagShare");r=share.showTextDialog('<div style="text-align:center;font-size:14px;">分享成功</div>',"分享",350,120);setTimeout(function(){r.close()}.bind(r),2000)}else{r=share.alert(w.error.errmsg,"分享")}}})};share.tag={own_shid:0,own_tagId:0};var u=parseInt(detail_share_info.tagnub),p;var m=function(g){var v=(g/u*100).toString();return"("+v.substring(0,v.indexOf(".")==-1?v.length:v.indexOf(".")+3)+"%)"};var t=function(x){var v=baidu.g("tagView"),w=baidu.g("frdViews");var g=document.createElement("p");g.className="my-view";g.innerHTML="我的观点:&nbsp;&nbsp;<span>"+x+"</span>";if(v){if(w){baidu.dom.insertBefore(g,w)}else{v.appendChild(g)}}else{v=document.createElement("div");v.id="tagView";v.className="tag-view clearfix";v.appendChild(g);l.appendChild(v)}};share.tag.init=function(){share.tag.T=[];var y=l.getElementsByTagName("ul")[0],x=y.getElementsByTagName("span"),g=y.getElementsByTagName("div"),w=s("moreTag");if(g.length==0){return}var v=w.parentNode;if(g.length<=20){v.parentNode.removeChild(v)}baidu.on(w,"click",function(){c(g,function(B,A){B.parentNode.style.display=""});if(p){var z=p;p.parentNode.removeChild(p);l.getElementsByTagName("ul")[0].appendChild(z)}v.parentNode.removeChild(v)});c(g,function(C,A){C.parentNode.style.display="";var B=C.firstChild;if(B.offsetWidth>n&&B.offsetWidth+18>h){C.parentNode.className="tags-m"}C.parentNode.style.display="none";if(A<20){C.parentNode.style.display=""}var z=parseInt(C.getAttribute("num"));a.push({obj:C,sup:z,ct:C.getAttribute("ct")});C.title="共有"+z+"人赞同此观点"+m(z)});s("tagPepCont").innerHTML=u};share.tag.click=function(x,w,g){if(window.spUserStatus=="0"){Space.Libs.loginDialog();return}var y=x.textContent?x.textContent:x.innerText;var v="_method=support_tag&shid="+w+"&tag_id="+g+"&bdstoken="+s("bdstoken").value,x=x;d(f,{method:"post",data:v,onsuccess:function(B,A){var z=baidu.json.parse(B.responseText);if(z.error.errno==0){e(x);share.tag.own_shid=w;share.tag.own_tagId=g;Space.Libs.ns_trackerLink("m_20100402_detailTagSup");t(y);r=share.showConformDialog("<div style='margin-bottom:20px'>观点发表成功，是否分享给好友？</div>",{title:"分享",needCen:true,width:380,funcOk:function(){o({shId:share.tag.own_shid,tagId:share.tag.own_tagId})}})}else{r=share.alert(z.error.errmsg,"分享")}}});return false};share.tag.over=function(y,x){var D=x?x:this;if(D.parentNode.className.indexOf("tags-m")==-1){D.className=D.className.replace(/tag-n\d{1,2}/,function(E){return"hover-"+E});return}D.parentNode.style.zIndex=5;var C=D.firstChild,B=C.clientWidth,A=C.scrollWidth-B,z=5;if(D.className.indexOf("hover-")==-1){D.className=D.className.replace(/tag-n\d{1,2}/,function(E){return"hover-"+E})}if(D.className.indexOf("noborder")==-1){D.className+=" noborder"}var v=function(){D.className+=" over";D.className=D.className.replace(/noborder/,"")};for(var w=1;w<=z;w++){function g(E){share.tag.T.push(setTimeout(function(){C.style.width=j.Linear(E,B,A,z)+"px";if(E==z){v()}},100))}g.call(D,w)}};share.tag.out=function(A,z){var v=z?z:this;if(v.parentNode.className.indexOf("tags-m")==-1){v.className=v.className.replace(/hover-(tag-n\d{1,2})/,function(C,B){return B});return}var A=A||window.event;var w=A.relatedTarget||A.toElement;if(w==v.firstChild||w==v){return}var y=share.tag.T,g=y.length;for(var x=0;x<g;x++){clearTimeout(y[x])}v.parentNode.style.zIndex=0;v.className=v.className.replace(/hover-(tag-n\d{1,2})/,function(C,B){return B});v.className=v.className.replace(/over/g,"");v.className=v.className.replace(/noborder/g,"");v.firstChild.style.width=n+"px"};share.tag.init();var k=l.getElementsByTagName("ul")[0].getElementsByTagName("div");c(k,function(v,g){i(v,"mouseover",share.tag.over);i(v,"mouseout",share.tag.out)});baidu.on(s("tagValue"),"focus",function(){if(window.spUserStatus=="0"){Space.Libs.loginDialog();return}if(baidu.string.trim(this.value)==share.msg.tag_input_hint){this.value=""}this.style.color="#000"});baidu.on(s("tagValue"),"blur",function(){if(baidu.string.trim(this.value)==""){this.value=share.msg.tag_input_hint;this.style.color="#a9a9a9"}});var e=function(A){var v=A;var y=share.tag.T,g=y.length;for(var x=0;x<g;x++){clearTimeout(y[x])}if(v.parentNode.className.indexOf("tags-m")==-1){v.className=v.className.replace(/hover-(tag-n\d{1,2})/,function(D,C){return C})}else{v.parentNode.style.zIndex=0;v.className=v.className.replace(/hover-(tag-n\d{1,2})/,function(D,C){return C});v.className=v.className.replace(/over/g,"");v.className=v.className.replace(/noborder/g,"");v.firstChild.style.width=n+"px"}u+=1;s("tagPepCont").innerHTML=u;var z=[],w=parseInt(A.getAttribute("num"));c(a,function(E,D){if(A!=E.obj){if(w==E.sup){z.push(E)}var C=parseInt(E.obj.getAttribute("num"));E.obj.title="共有"+C+"人赞同此观点"+m(C)}});A.setAttribute("num",w+1);A.title="共有"+(w+1)+"人赞同此观点"+m(w+1);var B=a[0].obj;if(A==B){return}var g=z.length;if(g!=0){baidu.dom.insertBefore(A.parentNode,z[0].obj.parentNode);A.className=A.className.replace(/tag-n(\d{1,2})/,z[0].obj.className.match(/tag-n(\d{1,2})/)[0]);c(z,function(D,C){z[C].obj.className=z[C].obj.className.replace(/tag-n(\d{1,2})/,function(F,E){if(parseInt(E)==14){return F}else{return F.substr(0,F.length-E.length)+(parseInt(E)+1)}})})}else{return}};baidu.on(q,"click",function(){if(window.spUserStatus=="0"){Space.Libs.loginDialog();return}var x=s("tagValue").value,w=detail_share_info.shid,g="_method=create_tag&shid="+w+"&tag_text="+x+"&bdstoken="+s("bdstoken").value,v=this;if(x==share.msg.tag_input_hint){return}d(f,{method:"post",data:g,onsuccess:function(E,D){var A=baidu.json.parse(E.responseText);if(A.error.errno==0){s("tagValue").value="";u+=1;s("tagPepCont").innerHTML=u;p=document.createElement("li");c(a,function(H,G){var F=parseInt(H.obj.getAttribute("num"));H.obj.title="共有"+F+"赞同此观点"+m(F)});var z="",y=a.length;if(y<14){z="tag-n"+(y+1)}else{z="tag-n14"}var C=A.error.tagid;p.innerHTML='<div  onmouseover="share.tag.over(event,this)" onmouseout="share.tag.out(event,this)" ct="1299733491" class="'+z+'" num="1" onclick="share.tag.click(this,'+w+","+C+')" title="共有1人赞同此观点'+m(1)+'"><span>'+x+"</span></div>";if(s("moreTag")){baidu.dom.insertAfter(p,a[19].obj.parentNode)}else{l.getElementsByTagName("ul")[0].appendChild(p)}var B=p.firstChild.firstChild;if(B.offsetWidth>n&&B.offsetWidth+18>h){p.className="tags-m"}t(x);Space.Libs.ns_trackerLink("m_20100402_detailTagSup");share.tag.own_shid=w;share.tag.own_tagId=C;r=share.showConformDialog("<div style='margin-bottom:20px'>观点发表成功，是否分享给好友？</div>",{title:"分享",needCen:true,width:380,funcOk:function(){o({shId:share.tag.own_shid,tagId:share.tag.own_tagId})}})}else{r=share.alert(A.error.errmsg,"分享")}}})})});if(typeof window.Space=="undefined"){window.Space={}}Space.Libs=Space.Libs||{};Space.Libs.xAjax=(function(){var a=function(c,f,k,i,g){var h=g?g:"x_post_iframe";var e=document.getElementById(h);if(e){e.parentNode.parentNode.removeChild(e.parentNode)}var j=document.createElement("div");j.innerHTML='<iframe style="display:none" id="'+h+'" name="'+h+'" src=""></iframe>';document.body.appendChild(j);var b=document.createElement("FORM");b.style.display="none";b.method="post";b.target=h;b.action=c;if(i){f.proxy=i}f.callback=k;for(var l in f){var d=document.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name",l);d.setAttribute("value",f[l]);b.appendChild(d)}document.body.appendChild(b);b.submit();b.parentNode.removeChild(b)};return{post:a}})();